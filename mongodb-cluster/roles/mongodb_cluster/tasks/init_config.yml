---
# Force initialize Config Server Replica Set â€” always runs

- name: Attempt to initialize config server replica set (ignore previous state)
  shell: |
    mongosh --port {{ config_port }} --quiet --eval '
    try {
      rs.initiate({
        _id: "{{ config_replset }}",
        configsvr: true,
        members: [
          { _id: 0, host: "192.168.121.106:{{ config_port }}" },
          { _id: 1, host: "192.168.121.107:{{ config_port }}" },
          { _id: 2, host: "192.168.121.108:{{ config_port }}" }
        ]
      })
    } catch (e) {
      print("Replica set may already be initialized: " + e)
    }
    '
  register: config_rs_init
  ignore_errors: yes

- name: Show config replica set initialization result
  debug:
    var: config_rs_init.stdout

- name: Wait for config replica set to stabilize
  pause:
    seconds: 30
